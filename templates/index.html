<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RapidCare - MCI Response System</title>
    <meta name="description" content="AI-powered mass casualty incident response system">
    <meta name="theme-color" content="#dc2626">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" type="image/png" href="/static/images/icon-192x192.png">
    <link rel="apple-touch-icon" href="/static/images/icon-192x192.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <div id="offline-indicator" class="hidden" style="position:fixed;top:0;left:0;width:100%;background:#dc2626;color:#fff;text-align:center;z-index:9999;padding:10px;display:none;">
      <strong>⚠️ Offline Mode</strong><br>
      Internet connection unavailable. Some features may be limited.<br>
      <small>Working with local AI models only.</small>
    </div>
    <div id="app">
        <!-- Login Screen -->
        <div id="login-screen" class="login-screen">
            <div class="login-container">
                <div class="login-header">
                    <div class="logo">
                        <i class="fas fa-heartbeat"></i>
                        <h1>RapidCare</h1>
                    </div>
                    <p class="login-subtitle">Mass Casualty Incident Response System</p>
                </div>
                
                <div class="login-options">
                    <h2>Select Your Role</h2>
                    <div class="role-cards">
                        <div class="role-card" data-role="PARAMEDIC">
                            <div class="role-icon">
                                <i class="fas fa-ambulance"></i>
                            </div>
                            <h3>Paramedic</h3>
                            <p>Emergency field assessment and triage</p>
                        </div>
                        
                        <div class="role-card" data-role="NURSE">
                            <div class="role-icon">
                                <i class="fas fa-user-nurse"></i>
                            </div>
                            <h3>Nurse</h3>
                            <p>Patient monitoring and vital updates</p>
                        </div>
                        
                        <div class="role-card" data-role="DOCTOR">
                            <div class="role-icon">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <h3>Doctor</h3>
                            <p>Medical assessment and SOAP notes</p>
                        </div>
                        
                        <div class="role-card" data-role="REUNIFICATION_COORDINATOR">
                            <div class="role-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3>Reunification Coordinator</h3>
                            <p>Family location and patient matching</p>
                        </div>
                    </div>
                </div>
                
                <div class="login-footer">
                    <div class="status-indicators">
                        <div class="status-item" id="connectivity-status">
                            <i class="fas fa-wifi"></i>
                            <span>Checking...</span>
                        </div>
                        <div class="status-item" id="edge-ai-status">
                            <i class="fas fa-microchip"></i>
                            <span>Google Edge AI</span>
                        </div>
                        <div class="status-item" id="jetson-status">
                            <i class="fas fa-robot"></i>
                            <span>Jetson</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="main-app" class="main-app hidden">
            <!-- Header -->
            <header class="header">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-heartbeat"></i>
                        <h1>RapidCare</h1>
                    </div>
                    <div class="user-info">
                        <div class="voice-input-dropdown">
                            <button class="voice-input-btn" id="voice-input-btn">
                                <i class="fas fa-microphone"></i>
                                <span>Voice Input</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="voice-dropdown-menu" id="voice-dropdown-menu">
                                <div class="voice-option" data-method="webkit">
                                    <i class="fas fa-microphone"></i>
                                    <span>Browser Speech Recognition</span>
                                    <small>Real-time transcription</small>
                                </div>
                                <div class="voice-option" data-method="gemma">
                                    <i class="fas fa-brain"></i>
                                    <span>Gemma 3n AI</span>
                                    <small>High-quality transcription</small>
                                </div>
                                <div class="voice-option" data-method="gemma-finetuned">
                                    <i class="fas fa-cogs"></i>
                                    <span>Gemma 3n Fine-tuned</span>
                                    <small>Medical transcription</small>
                                </div>
                            </div>
                        </div>
                        
                        <span id="welcome-text">Welcome</span>
                        <button class="logout-btn" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </button>
                    </div>
                    <div class="status-indicators">
                        <div class="status-item" id="connectivity-status-main">
                            <i class="fas fa-wifi"></i>
                            <span>Checking...</span>
                        </div>
                        <div class="status-item" id="edge-ai-status-main">
                            <i class="fas fa-microchip"></i>
                            <span>Google Edge AI</span>
                        </div>
                        <div class="status-item" id="jetson-status-main">
                            <i class="fas fa-robot"></i>
                            <span>Jetson</span>
                        </div>
                        <div class="status-item" id="offline-storage-status">
                            <i class="fas fa-database"></i>
                            <span>Storage</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="main-content">
                <!-- System Messages -->
                <div class="system-messages" id="system-messages">
                    <div class="system-messages-header" id="system-messages-header">
                        <div class="system-messages-toggle">
                            <i class="fas fa-chevron-down" id="system-toggle-icon"></i>
                            <span id="system-messages-count">1 message</span>
                        </div>
                        <button class="clear-messages-btn" id="clear-messages-btn" title="Clear all messages">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="system-messages-content" id="system-messages-content">
                        <div class="message system">
                            <div class="message-content">
                                <i class="fas fa-info-circle"></i>
                                <span>System ready. Select an action to begin.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Patient List -->
                <div class="patient-section" id="patient-section" style="cursor: pointer;">
                    <h3>Recent Patients <i class="fas fa-chevron-right" style="font-size: 0.8em; margin-left: 10px;"></i></h3>
                    <div id="patients-list" class="patients-list"></div>
                </div>

                <!-- Action Grid -->
                <div class="action-grid">
                    <div class="action-card" data-action="video-analysis">
                        <div class="action-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <h3>Video Analysis</h3>
                        <p>Analyze video footage for patient assessment and triage</p>
                        <button class="action-btn">
                            <i class="fas fa-play"></i>
                            Start Analysis
                        </button>
                    </div>

                    <div class="action-card" data-action="image-analysis">
                        <div class="action-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <h3>Image Analysis</h3>
                        <p>Analyze photos for patient condition assessment</p>
                        <button class="action-btn">
                            <i class="fas fa-upload"></i>
                            Upload Image
                        </button>
                    </div>

                    <div class="action-card" data-action="voice-input">
                        <div class="action-icon">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <h3>Voice Input</h3>
                        <p>Record voice notes for patient assessment</p>
                        <button class="action-btn">
                            <i class="fas fa-record-vinyl"></i>
                            Start Recording
                        </button>
                    </div>

                    <div class="action-card" data-action="ai-search">
                        <div class="action-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3>AI Search</h3>
                        <p>Search medical records and get AI-powered insights</p>
                        <button class="action-btn">
                            <i class="fas fa-brain"></i>
                            Search Records
                        </button>
                    </div>

                    <div class="action-card" data-action="create-patient">
                        <div class="action-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h3>Create Patient</h3>
                        <p>Manually create a new patient record</p>
                        <button class="action-btn">
                            <i class="fas fa-plus"></i>
                            Add Patient
                        </button>
                    </div>

                    <div class="action-card" data-action="view-patients">
                        <div class="action-icon">
                            <i class="fas fa-list"></i>
                        </div>
                        <h3>View Patients</h3>
                        <p>View and manage all patient records</p>
                        <button class="action-btn">
                            <i class="fas fa-eye"></i>
                            View All
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Modals -->
        
        <!-- Patient Modal -->
        <div id="patient-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add New Patient</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="patient-form">
                        <div class="form-group">
                            <label for="patient-rfid">RFID Tag:</label>
                            <input type="text" id="patient-rfid" readonly placeholder="Auto-generated RFID">
                        </div>
                        <div class="form-group">
                            <label for="patient-name">Patient Name:</label>
                            <input type="text" id="patient-name" placeholder="Enter name or 'Unknown' for unconscious patients">
                        </div>
                        <div class="form-group">
                            <label for="patient-age">Age (if known):</label>
                            <input type="number" id="patient-age" placeholder="Age in years">
                        </div>
                        <div class="form-group">
                            <label for="triage-level">Triage Level:</label>
                            <select id="triage-level" required>
                                <option value="Red">Red - Immediate</option>
                                <option value="Yellow">Yellow - Delayed</option>
                                <option value="Green">Green - Minor</option>
                                <option value="Black">Black - Deceased</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="patient-location">Location:</label>
                            <input type="text" id="patient-location" placeholder="Zone A, Triage Tent, etc.">
                        </div>
                        <div class="form-group">
                            <label for="patient-notes">Medical Notes:</label>
                            <div class="notes-input-container">
                                <textarea id="patient-notes" placeholder="Injuries, symptoms, treatment provided, etc."></textarea>
                                <button id="notes-voice-btn" class="notes-voice-btn" title="Voice Dictation">
                                    <i class="fas fa-microphone"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Add Patient</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Media Upload Modal -->
        <div id="media-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="media-modal-title">Upload Media</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="media-tabs">
                        <button class="tab-btn active" data-tab="camera">Camera</button>
                        <button class="tab-btn" data-tab="upload">Upload File</button>
                    </div>
                    
                    <div class="tab-content">
                        <!-- Camera Tab -->
                        <div class="tab-pane active" id="camera-tab">
                            <div class="camera-container">
                                <video id="camera-preview" autoplay muted playsinline></video>
                                <canvas id="capture-canvas" style="display: none;"></canvas>
                                <div class="camera-controls">
                                    <button id="capture-btn" class="btn-primary">
                                        <i class="fas fa-camera"></i>
                                        Capture
                                    </button>
                                    <button id="record-btn" class="btn-primary">
                                        <i class="fas fa-video"></i>
                                        Start Recording
                                    </button>
                                    <button id="stop-record-btn" class="btn-secondary" style="display: none;">
                                        <i class="fas fa-stop"></i>
                                        Stop Recording
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Upload Tab -->
                        <div class="tab-pane" id="upload-tab">
                            <div class="upload-container">
                                <div class="upload-area" id="upload-area">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Drag & drop files here or click to browse</p>
                                    <input type="file" id="file-input" accept="image/*,video/*" multiple style="display: none;">
                                </div>
                                <div class="file-list" id="file-list"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="media-actions">
                        <button id="analyze-media-btn" class="btn-primary">
                            <i class="fas fa-brain"></i>
                            Analyze Media
                        </button>
                        <button id="close-media-btn" class="btn-secondary">
                            <i class="fas fa-times"></i>
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Triage Result Modal -->
        <div id="triage-modal" class="modal">
            <div class="modal-content triage-modal-content">
                <div class="modal-header">
                    <h3>Triage Assessment Result</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body" id="triage-modal-body">
                    <!-- Triage result will be inserted here -->
                </div>
            </div>
        </div>

        <!-- SOAP Notes Modal -->
        <div id="soap-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>SOAP Notes</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="soap-notes-list">
                        <!-- SOAP notes will be loaded here -->
                    </div>
                    <form id="soap-form">
                        <input type="hidden" id="soap-patient-id">
                        <div class="form-group">
                            <label for="soap-subjective">Subjective:</label>
                            <div class="notes-input-container">
                                <textarea id="soap-subjective" placeholder="Patient's chief complaint and history..." required></textarea>
                                <button id="soap-subjective-voice-btn" class="notes-voice-btn" title="Voice Dictation">
                                    <i class="fas fa-microphone"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="soap-objective">Objective:</label>
                            <div class="notes-input-container">
                                <textarea id="soap-objective" placeholder="Physical examination findings, vital signs..." required></textarea>
                                <button id="soap-objective-voice-btn" class="notes-voice-btn" title="Voice Dictation">
                                    <i class="fas fa-microphone"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="soap-assessment">Assessment:</label>
                            <div class="notes-input-container">
                                <textarea id="soap-assessment" placeholder="Diagnosis and differential diagnoses..." required></textarea>
                                <button id="soap-assessment-voice-btn" class="notes-voice-btn" title="Voice Dictation">
                                    <i class="fas fa-microphone"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="soap-plan">Plan:</label>
                            <div class="notes-input-container">
                                <textarea id="soap-plan" placeholder="Treatment plan, medications, follow-up..." required></textarea>
                                <button id="soap-plan-voice-btn" class="notes-voice-btn" title="Voice Dictation">
                                    <i class="fas fa-microphone"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Save SOAP Note</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- AI Search Modal -->
        <div id="ai-search-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>AI-Powered Description Search</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="search-container">
                        <div class="form-group">
                            <label for="description-search-input">Describe the missing person:</label>
                            <textarea id="description-search-input" placeholder="Describe physical features, clothing, distinctive characteristics... Example: 'My brother is about 5'8", brown hair, blue eyes, wearing a red shirt and blue jeans, has a scar on his left cheek'" rows="4"></textarea>
                        </div>
                        <div class="search-examples">
                            <p><strong>Example descriptions:</strong></p>
                            <ul>
                                <li>"My daughter is 10 years old, blonde hair, blue eyes, wearing a pink dress"</li>
                                <li>"My father is elderly, gray hair, glasses, wearing a blue jacket"</li>
                                <li>"My friend is 25, black hair, brown eyes, tattoo on right arm, wearing jeans"</li>
                            </ul>
                        </div>
                        <button id="description-search-btn" class="btn-primary">
                            <i class="fas fa-search"></i>
                            Search by Description
                        </button>
                    </div>
                    
                    <div class="search-results" id="search-results">
                        <!-- Search results will be displayed here -->
                    </div>
                    
                    <div class="modal-actions">
                        <button id="close-ai-search-btn" class="btn-secondary">
                            <i class="fas fa-times"></i>
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vitals Entry Modal -->
        <div id="vitals-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Enter Vitals</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="vitals-form">
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <button type="button" id="vitals-record-btn" class="btn-primary" style="background:#dc2626;color:#fff;">Record Vitals</button>
                        </div>
                        <div id="vitals-record-progress" style="margin-bottom:10px; color:#dc2626; font-weight:bold; display:none;"></div>
                        <input type="hidden" id="vitals-patient-id">
                        <div class="form-group">
                            <label for="vitals-heart-rate">Heart Rate (BPM):</label>
                            <div class="notes-input-container">
                                <input type="number" id="vitals-heart-rate" min="0" max="300" step="1" required>
                                <button id="vitals-heart-rate-voice-btn" class="notes-voice-btn" title="Voice Input"><i class="fas fa-microphone"></i></button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Blood Pressure (mmHg):</label>
                            <div class="notes-input-container">
                                <input type="number" id="vitals-bp-sys" min="0" max="300" step="1" placeholder="Sys" required style="width: 80px; display: inline-block;"> /
                                <input type="number" id="vitals-bp-dia" min="0" max="200" step="1" placeholder="Dia" required style="width: 80px; display: inline-block;">
                                <button id="vitals-bp-voice-btn" class="notes-voice-btn" title="Voice Input"><i class="fas fa-microphone"></i></button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="vitals-resp-rate">Respiratory Rate:</label>
                            <div class="notes-input-container">
                                <input type="number" id="vitals-resp-rate" min="0" max="100" step="1" required>
                                <button id="vitals-resp-rate-voice-btn" class="notes-voice-btn" title="Voice Input"><i class="fas fa-microphone"></i></button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="vitals-o2-sat">O₂ Saturation (%):</label>
                            <div class="notes-input-container">
                                <input type="number" id="vitals-o2-sat" min="0" max="100" step="0.1" required>
                                <button id="vitals-o2-sat-voice-btn" class="notes-voice-btn" title="Voice Input"><i class="fas fa-microphone"></i></button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="vitals-temperature">Temperature (°F):</label>
                            <div class="notes-input-container">
                                <input type="number" id="vitals-temperature" min="80" max="120" step="0.1" required>
                                <button id="vitals-temperature-voice-btn" class="notes-voice-btn" title="Voice Input"><i class="fas fa-microphone"></i></button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="vitals-pain-score">Pain Score (0-10):</label>
                            <div class="notes-input-container">
                                <input type="number" id="vitals-pain-score" min="0" max="10" step="1">
                                <button id="vitals-pain-score-voice-btn" class="notes-voice-btn" title="Voice Input"><i class="fas fa-microphone"></i></button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="vitals-timestamp">Timestamp:</label>
                            <input type="datetime-local" id="vitals-timestamp" required>
                        </div>
                        <button type="submit" class="btn-primary">Save Vitals</button>
                        <!-- Removed audio upload, progress, and transcription UI -->
                    </form>
                    <hr>
                    <div id="vitals-history">
                        <h4>Vitals History</h4>
                        <div id="vitals-history-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Patients List Modal -->
        <div id="patients-list-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>All Patients</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="patients-controls">
                        <div class="patients-stats">
                            <span id="patients-count">0 patients</span>
                        </div>
                        <div class="patients-filters">
                            <select id="triage-filter">
                                <option value="">All Triage Levels</option>
                                <option value="Red">Red - Immediate</option>
                                <option value="Yellow">Yellow - Delayed</option>
                                <option value="Green">Green - Minor</option>
                                <option value="Black">Black - Deceased</option>
                            </select>
                        </div>
                    </div>
                    <div id="all-patients-list" class="all-patients-list">
                        <div class="loading-state" style="text-align: center; padding: 20px; color: #6b7280;">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Loading patients...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Missing Person Modal -->
        <div id="missing-person-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Submit Missing Person Report</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-note">
                        <i class="fas fa-info-circle"></i>
                        <strong>Note:</strong> Only a photo is required. AI will automatically extract physical characteristics for matching. Additional information helps but is optional.
                    </div>
                    <form id="missing-person-form">
                        <div class="form-group">
                            <label for="missing-person-name">Name:</label>
                            <input type="text" id="missing-person-name" name="name" placeholder="Full name (optional)">
                        </div>
                        <div class="form-group">
                            <label for="missing-person-age">Age:</label>
                            <input type="number" id="missing-person-age" name="age" placeholder="Age in years (optional)">
                        </div>
                        <div class="form-group">
                            <label for="missing-person-description">Description:</label>
                            <textarea id="missing-person-description" name="description" placeholder="Physical description, clothing, distinctive features... (optional)"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="missing-person-contact">Contact Information:</label>
                            <input type="text" id="missing-person-contact" name="contact_info" placeholder="Phone number, email, or other contact">
                        </div>
                        <div class="form-group">
                            <label for="missing-person-photo">Photo:</label>
                            <div class="photo-upload-area" id="photo-upload-area">
                                <i class="fas fa-camera"></i>
                                <p>Click to upload photo or take picture</p>
                                <input type="file" id="missing-person-photo-input" accept="image/*" style="display: none;">
                            </div>
                            <div id="photo-preview" class="photo-preview" style="display: none;">
                                <img id="photo-preview-img" src="" alt="Photo preview">
                                <button type="button" id="remove-photo-btn" class="btn-secondary">
                                    <i class="fas fa-times"></i> Remove
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-upload"></i>
                            Submit Report (Photo Required)
                        </button>
                        
                        <!-- Progress Indicator -->
                        <div id="missing-person-progress" class="progress-indicator" style="display: none;">
                            <div class="progress-header">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span id="progress-text">Processing...</span>
                            </div>
                            <div class="progress-steps">
                                <div class="progress-step" data-step="upload">
                                    <i class="fas fa-upload"></i>
                                    <span>Uploading image...</span>
                                </div>
                                <div class="progress-step" data-step="extract">
                                    <i class="fas fa-brain"></i>
                                    <span>Extracting characteristics...</span>
                                </div>
                                <div class="progress-step" data-step="save">
                                    <i class="fas fa-save"></i>
                                    <span>Saving to database...</span>
                                </div>
                                <div class="progress-step" data-step="index">
                                    <i class="fas fa-search"></i>
                                    <span>Indexing for search...</span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Missing Persons List Modal -->
        <div id="missing-persons-list-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Missing Persons Database</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="missing-persons-list" class="missing-persons-list">
                        <!-- Missing persons will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Offline Indicator -->
        <div id="offline-indicator" class="offline-indicator hidden">
            <i class="fas fa-wifi-slash"></i>
            <span>Working Offline</span>
        </div>

        <!-- Voice Input Modal -->
        <div id="voice-input-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Voice Input Options</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="voice-options">
                        <div class="voice-option" data-method="webkit">
                            <div class="voice-option-header">
                                <i class="fas fa-microphone"></i>
                                <h4>Browser Speech Recognition</h4>
                            </div>
                            <p>Real-time transcription using your browser's built-in speech recognition. Fast and responsive.</p>
                            <button class="btn-primary" onclick="app.startWebkitVoiceInput()">
                                <i class="fas fa-play"></i>
                                Start Recording
                            </button>
                        </div>
                        
                        <div class="voice-option" data-method="gemma">
                            <div class="voice-option-header">
                                <i class="fas fa-brain"></i>
                                <h4>Gemma 3n AI Transcription</h4>
                            </div>
                            <p>High-quality transcription using Gemma 3n model. Better accuracy for medical terminology.</p>
                            <button class="btn-primary" onclick="app.startGemmaVoiceInput()">
                                <i class="fas fa-upload"></i>
                                Record & Transcribe
                            </button>
                        </div>
                        
                        <div class="voice-option" data-method="gemma-finetuned">
                            <div class="voice-option-header">
                                <i class="fas fa-cogs"></i>
                                <h4>Gemma 3n Fine-tuned</h4>
                            </div>
                            <p>Specialized medical transcription using fine-tuned Gemma 3n model. Best for clinical documentation.</p>
                            <button class="btn-primary" onclick="app.startGemmaFineTunedVoiceInput()">
                                <i class="fas fa-stethoscope"></i>
                                Medical Transcription
                            </button>
                        </div>
                    </div>
                    
                    <div id="voice-recording-section" class="voice-recording-section" style="display: none;">
                        <div class="recording-status">
                            <div class="recording-indicator">
                                <i class="fas fa-circle recording-pulse"></i>
                                <span id="recording-status-text">Recording...</span>
                            </div>
                        </div>
                        <div class="recording-controls">
                            <button id="stop-recording-btn" class="btn-secondary">
                                <i class="fas fa-stop"></i>
                                Stop Recording
                            </button>
                        </div>
                        <div id="transcription-preview" class="transcription-preview">
                            <h5>Transcription Preview:</h5>
                            <div id="transcription-text" class="transcription-text"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/prompts.js"></script>
    <script src="/static/js/app.js?v=3"></script>
    <script src="/static/js/sw.js"></script>
</body>
</html> 